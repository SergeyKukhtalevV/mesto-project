(()=>{"use strict";var t=document.querySelector(".content"),e=t.querySelector(".button_type_edit"),o=t.querySelector(".button_type_add"),n=t.querySelector(".button_type_avatar"),r=t.querySelector(".profile__name"),c=t.querySelector(".profile__about"),a=t.querySelector(".profile__avatar"),i=document.querySelector(".profile-popup"),u=document.querySelector(".card-popup"),l=document.querySelector(".image-popup"),s=document.querySelector(".delete-popup"),d=document.querySelector(".avatar-popup"),f=document.querySelectorAll(".popup"),p=document.querySelectorAll(".popup__form"),m=i.querySelector("#name"),y=i.querySelector("#about-yourself"),_=u.querySelector("#name-card"),v=u.querySelector("#link-card"),h=d.querySelector("#link-avatar"),g=document.querySelector("#item-template").content,S=l.querySelector(".figure__image"),b=l.querySelector(".figure__caption"),q=t.querySelector(".gallery__list");function k(t){t.classList.add("button_inactive"),t.setAttribute("disabled","disabled")}function L(t){"Escape"===t.key&&C(document.querySelector(".popup_opened"))}function E(t){t.classList.add("popup_opened"),document.addEventListener("keydown",L)}function C(t){document.removeEventListener("keydown",L),t.classList.remove("popup_opened")}function A(t){t.setAttribute("disabled","disabled"),t.classList.add("button_loading")}function j(t){t.classList.add("button_loaded")}function x(t){t.classList.remove("button_loading"),t.classList.remove("button_loaded")}var P,T,z,w="https://nomoreparties.co/v1/plus-cohort-15",B="c362a370-694e-40e1-b195-d72fbbfd69f7",N="application/json";function O(t){t.classList.toggle("button_type_like-active")}function D(t,e,o){var n,r=t.target,c=r.closest(".gallery__item"),a=c.querySelector(".gallery__counter-likes");return o=c.id,e?function(t){return fetch("".concat(w,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:B}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))}(o).then((function(t){O(r),console.log("Сервер прислал карточку с уменьшенным счетчиком лайков",t),a.textContent=t.likes.length})).catch((function(t){console.log("Ошибка, запрос на уменьшение количества лайков не выполнен",t)})):(n=o,fetch("".concat(w,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:B}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){O(r),console.log("Сервер прислал карточку с увеличенным счетчиком лайков",t),a.textContent=t.likes.length})).catch((function(t){console.log("Ошибка, запрос на увеличение количества лайков не выполнен",t)})),!e}function J(t,e,o,n,r,c,a){var i=function(t,e,o,n,r,c,a){t=t.trim(),e=e.trim();var i=a.querySelector(".gallery__item").cloneNode(!0),u=i.querySelector(".gallery__photo"),d=i.querySelector(".gallery__title"),f=i.querySelector(".gallery__counter-likes"),p=i.querySelector(".button_type_delete");return u.src=t,u.alt=e,d.textContent=e,f.textContent=o,i.id=c,n===r&&(p.classList.add("button_visible"),p.addEventListener("click",(function(t){P=t.target.closest(".gallery__item").id,E(s)}))),u.addEventListener("error",(function(){return function(t){console.log("Ошибка загрузки изображения",t.src)}(u)})),u.addEventListener("click",(function(){return o=t,n=e,S.src=o,S.alt=n,b.textContent=n,void E(l);var o,n})),i}(t,e,o,n,r,c,g);i.querySelector(".button_type_like").addEventListener("click",a),q.prepend(i)}Promise.all([fetch("".concat(w,"/users/me"),{headers:{authorization:B}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})),fetch("".concat(w,"/cards"),{headers:{authorization:B}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))]).then((function(t){r.textContent=t[0].name,c.textContent=t[0].about,a.src=t[0].avatar,T=t[0]._id,console.log("Получены данные пользователя и список карточек",t),Array.from(t[1]).forEach((function(t){var e=!1;J(t.link,t.name,t.likes.length,T,t.owner._id,t._id,(function(t){e=D(t,e,z)}))}))})).catch((function(t){console.log("Ошибка, запрос на получение данных пользователя и список карточек не выполнен",t)})),n.addEventListener("click",(function(){E(d)})),e.addEventListener("click",(function(){E(i),m.value=r.textContent,y.value=c.textContent})),o.addEventListener("click",(function(){return E(u)})),f.forEach((function(t){t.addEventListener("mousedown",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("button_type_сlose"))&&C(t)}))})),p.forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault();var o,n,l=e.target.querySelector(".button_type_submit");"edit-profile"===t.getAttribute("name")&&function(t){var e,o;A(t),(e=m.value,o=y.value,fetch("".concat(w,"/users/me"),{method:"PATCH",headers:{authorization:B,"Content-Type":N},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(e){j(t),r.textContent=e.name,c.textContent=e.about,console.log("Запрос на изменение данных пользователя выполнен успешно."),C(i)})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})).finally((function(){setTimeout((function(){x(t)}),500)}))}(l),"card-add"===t.getAttribute("name")&&function(t,e){var o,n;A(e),(o=_.value,n=v.value,fetch("".concat(w,"/cards"),{method:"POST",headers:{authorization:B,"Content-Type":N},body:JSON.stringify({name:o,link:n})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){j(e),console.log("Сервер прислал созданный объект карточка",t);var o=!1;J(t.link,t.name,t.likes.length,T,t.owner._id,t._id,(function(t){o=D(t,o,z)})),C(u)})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})).finally((function(){k(e),t.target.reset(),setTimeout((function(){x(e)}),500)}))}(e,l),"delete-card"===t.getAttribute("name")&&(n=o=P,fetch("".concat(w,"/cards/").concat(n),{method:"DELETE",headers:{authorization:B,"Content-Type":N}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){console.log("Удалено с результатом ",t),function(t){document.getElementById(t).remove()}(o),C(s)})).catch((function(t){console.log("Ошибка, запрос на удаление не выполнен",t)})),"edit-avatar"===t.getAttribute("name")&&function(t){var e;A(t),(e=h.value,fetch("".concat(w,"/users/me/avatar"),{method:"PATCH",headers:{authorization:B,"Content-Type":N},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(e){j(t),console.log("Запрос на изменение аватара пользователя выполнен успешно.",e),a.src=e.avatar,C(d),h.value=""})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})).finally((function(){k(t),setTimeout((function(){x(t)}),500)}))}(l)}))})),function(t){var e=t.formSelector,o=t.fieldsetSelector,n=t.inputSelector,r=t.submitButtonSelector,c=t.inactiveButtonClass,a=t.inputErrorClass,i=t.errorClass;function u(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o),e.removeAttribute("disabled")):(e.classList.add(o),e.setAttribute("disabled","disabled"))}Array.from(document.querySelectorAll(e)).forEach((function(t){Array.from(t.querySelectorAll(o)).forEach((function(t){!function(t,e,o,n,r,c){var a=Array.from(t.querySelectorAll(e)),i=t.querySelector(o);u(a,i,n),a.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,o,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o),r.classList.remove(n),r.textContent=""}(t,e,o,n):function(t,e,o,n,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),c.textContent=n,c.classList.add(r)}(t,e,o,e.validationMessage,n)}(t,e,r,c),u(a,i,n)}))}))}(t,n,r,c,a,i)}))}))}({formSelector:".popup__form",fieldsetSelector:".popup__fieldset",inputSelector:".popup__input-text",submitButtonSelector:".button_type_submit",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input-text_type_error",errorClass:"popup__input-error_active"})})();