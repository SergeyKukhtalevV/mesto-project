(()=>{"use strict";var t,e=document.querySelector(".content"),o=e.querySelector(".button_type_edit"),n=e.querySelector(".button_type_add"),r=e.querySelector(".button_type_avatar"),c=e.querySelector(".profile__name"),a=e.querySelector(".profile__about"),i=e.querySelector(".profile__avatar"),u=document.querySelector(".profile-popup"),l=document.querySelector(".card-popup"),s=document.querySelector(".image-popup"),d=document.querySelector(".delete-popup"),f=document.querySelector(".avatar-popup"),p=document.querySelectorAll(".popup"),m=document.querySelectorAll(".popup__form"),_=u.querySelector("#name"),y=u.querySelector("#about-yourself"),v=l.querySelector("#name-card"),h=l.querySelector("#link-card"),g=f.querySelector("#link-avatar"),b=document.querySelector("#item-template").content,S=s.querySelector(".figure__image"),q=s.querySelector(".figure__caption"),L=e.querySelector(".gallery__list");function k(t){t.classList.add("button_inactive"),t.setAttribute("disabled","disabled")}function C(t){"Escape"===t.key&&A(document.querySelector(".popup_opened"))}function E(t){t.classList.add("popup_opened"),document.addEventListener("keydown",C)}function A(t){document.removeEventListener("keydown",C),t.classList.remove("popup_opened")}function j(t){t.classList.toggle("button_type_like-active")}function x(e,o,n,r,c,a,i){var u=function(e,o,n,r,c,a,i){e=e.trim(),o=o.trim();var u=i.querySelector(".gallery__item").cloneNode(!0),l=u.querySelector(".gallery__photo"),f=u.querySelector(".gallery__title"),p=u.querySelector(".gallery__counter-likes"),m=u.querySelector(".button_type_delete");return l.src=e,l.alt=o,f.textContent=o,p.textContent=n,u.id=a,r===c&&(m.classList.add("button_visible"),m.addEventListener("click",(function(e){t=e.target.closest(".gallery__item").id,E(d)}))),l.addEventListener("error",(function(){return function(t){console.log("Ошибка загрузки изображения",t.src)}(l)})),l.addEventListener("click",(function(){return t=e,n=o,S.src=t,S.alt=n,q.textContent=n,void E(s);var t,n})),u}(e,o,n,r,c,a,b);u.querySelector(".button_type_like").addEventListener("click",i),L.prepend(u)}var P,T,z="https://nomoreparties.co/v1/plus-cohort-15",w="c362a370-694e-40e1-b195-d72fbbfd69f7",B="application/json";function N(t){return fetch("".concat(z,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:w}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))}function O(t){return fetch("".concat(z,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:w}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))}var D=fetch("".concat(z,"/users/me"),{headers:{authorization:w}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){c.textContent=t.name,a.textContent=t.about,i.src=t.avatar,P=t._id})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})),J=fetch("".concat(z,"/cards"),{headers:{authorization:w}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){Array.from(t).forEach((function(t){var e=!1;x(t.link,t.name,t.likes.length,P,t.owner._id,t._id,(function(){var t=event.target,o=t.closest(".gallery__item"),n=o.querySelector(".gallery__counter-likes");j(t),T=o.id,e?O(T).then((function(t){console.log("Сервер прислал карточку с уменьшенным счетчиком лайков",t),e=!1,n.textContent=t.likes.length})).catch((function(t){console.log("Ошибка, запрос на уменьшение количества лайков не выполнен",t)})):N(T).then((function(t){console.log("Сервер прислал карточку с увеличенным счетчиком лайков",t),e=!0,n.textContent=t.likes.length})).catch((function(t){console.log("Ошибка, запрос на увеличение количества лайков не выполнен",t)}))}))}))})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)}));Promise.all([D,J]).then((function(t){console.log("Получены данные пользователя и список карточек")})).catch((function(){console.log("Ошибка, запрос на получение данных пользователя и список карточек не выполнен")})),r.addEventListener("click",(function(){E(f)})),o.addEventListener("click",(function(){E(u),_.value=c.textContent,y.value=a.textContent})),n.addEventListener("click",(function(){return E(l)})),p.forEach((function(t){t.addEventListener("mousedown",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("button_type_сlose"))&&A(t)}))})),m.forEach((function(e){e.addEventListener("submit",(function(o){var n,r;o.preventDefault(),"edit-profile"===e.getAttribute("name")&&function(t){var e,o,n=t.target.querySelector(".button_type_submit");n.classList.add("button_loading"),(e=_.value,o=y.value,fetch("".concat(z,"/users/me"),{method:"PATCH",headers:{authorization:w,"Content-Type":B},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){n.classList.add("button_loaded"),c.textContent=t.name,a.textContent=t.about,console.log("Запрос на изменение данных пользователя выполнен успешно."),A(u)})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})).finally((function(){setTimeout((function(){n.classList.remove("button_loading"),n.classList.remove("button_loaded")}),500)}))}(o),"card-add"===e.getAttribute("name")&&function(t){var e,o,n=t.target.querySelector(".button_type_submit");n.setAttribute("disabled","disabled"),n.classList.add("button_loading"),(e=v.value,o=h.value,fetch("".concat(z,"/cards"),{method:"POST",headers:{authorization:w,"Content-Type":B},body:JSON.stringify({name:e,link:o})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){n.classList.add("button_loaded"),console.log("Сервер прислал созданный объект карточка",t);var e=!1;x(t.link,t.name,t.likes.length,P,t.owner._id,t._id,(function(){var t=event.target,o=t.closest(".gallery__item"),n=o.querySelector(".gallery__counter-likes");T=o.id,e?O(T).then((function(o){j(t),console.log("Сервер прислал карточку с уменьшенным счетчиком лайков",o),e=!1,n.textContent=o.likes.length})).catch((function(t){console.log("Ошибка, запрос на уменьшение количества лайков не выполнен",t)})):N(T).then((function(o){j(t),console.log("Сервер прислал карточку с увеличенным счетчиком лайков",o),e=!0,n.textContent=o.likes.length})).catch((function(t){console.log("Ошибка, запрос на увеличение количества лайков не выполнен",t)}))})),A(l)})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})).finally((function(){k(n),t.target.reset(),setTimeout((function(){n.classList.remove("button_loading"),n.classList.remove("button_loaded")}),500)}))}(o),"delete-card"===e.getAttribute("name")&&(r=n=t,fetch("".concat(z,"/cards/").concat(r),{method:"DELETE",headers:{authorization:w,"Content-Type":B}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){console.log("Удалено с результатом ",t),function(t){document.getElementById(t).remove()}(n),A(d)})).catch((function(t){console.log("Ошибка, запрос на удаление не выполнен",t)})),"edit-avatar"===e.getAttribute("name")&&function(t){var e,o=t.target.querySelector(".button_type_submit");o.classList.add("button_loading"),(e=g.value,fetch("".concat(z,"/users/me/avatar"),{method:"PATCH",headers:{authorization:w,"Content-Type":B},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))).then((function(t){o.classList.add("button_loaded"),console.log("Запрос на изменение аватара пользователя выполнен успешно.",t),i.src=t.avatar,A(f),g.value=""})).catch((function(t){console.log("Ошибка, запрос не выполнен",t)})).finally((function(){k(o),setTimeout((function(){o.classList.remove("button_loading"),o.classList.remove("button_loaded")}),500)}))}(o)}))})),function(t){var e=t.formSelector,o=t.fieldsetSelector,n=t.inputSelector,r=t.submitButtonSelector,c=t.inactiveButtonClass,a=t.inputErrorClass,i=t.errorClass;function u(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o),e.removeAttribute("disabled")):(e.classList.add(o),e.setAttribute("disabled","disabled"))}Array.from(document.querySelectorAll(e)).forEach((function(t){Array.from(t.querySelectorAll(o)).forEach((function(t){!function(t,e,o,n,r,c){var a=Array.from(t.querySelectorAll(e)),i=t.querySelector(o);u(a,i,n),a.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,o,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o),r.classList.remove(n),r.textContent=""}(t,e,o,n):function(t,e,o,n,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),c.textContent=n,c.classList.add(r)}(t,e,o,e.validationMessage,n)}(t,e,r,c),u(a,i,n)}))}))}(t,n,r,c,a,i)}))}))}({formSelector:".popup__form",fieldsetSelector:".popup__fieldset",inputSelector:".popup__input-text",submitButtonSelector:".button_type_submit",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input-text_type_error",errorClass:"popup__input-error_active"})})();